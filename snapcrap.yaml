version: 'edge' # just for humans, typically '1.2+git' or '1.3.2'
name: ntpsec-jamesb192
summary: a secure, hardened, and improved implementation of Network Time Protocol
description: |
         NTPsec, as its name implies, is a more secure NTP. Our goal is to
         deliver code that can be used with confidence in deployments with the
         most stringent security, availability, and assurance requirements.
         Towards that end we apply best practices and state-of-the art
         technology in code auditing, verification, and testing. We begin with
         the most important best practice: true open-source code review.
         The NTPsec code is available in a public git repository. One of our
         goals is to support broader community participation.

grade: devel # must be 'stable' to release into candidate/stable channels
confinement: classic # use 'strict' once you have the right plugs and slots

apps:
  d:
    command: sbin/ntpd -gmnN -c $SNAP/etc/ntp.conf
    plugs: [network,network-bind,serial-port]
    daemon: simple
    restart-condition: never
  dig:
    command: bin/ntpdig
    plugs: [network]
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages
  frob:
    command: bin/ntpfrob
  keygen:
    command: bin/ntpkeygen
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages
  leapfetch:
    command: bin/ntpleapfetch
    plugs: [network]
  loggps:
    command: bin/ntploggps
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages
  logtemp:
    command: bin/ntplogtemp
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages
  mon:
    command: bin/ntpmon
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages
    plugs: [network]
  q:
    command: bin/ntpq
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages
    plugs: [network]
  snmpd:
    command: bin/ntpsnmpd
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages
  time:
    command: bin/ntptime
    plugs: [network]
  sweep:
    command: bin/ntpsweep
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages
    plugs: [network]
  trace:
    command: bin/ntptrace
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages
    plugs: [network]
  viz:
    command: bin/ntpviz
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages
  wait:
    command: bin/ntpwait.py
    environment:
      PYTHONPATH: $SNAP/lib/python2.7/site-packages

parts:
#  python3-ntplib:
#    plugin: python
#    python-version: pytho3
  ntpsec-jamesb192:
    build-packages:
       [build-essential,bison,libavahi-compat-libdnssd-dev,libcap2,libcap-dev,libseccomp-dev,libssl1.0.0,libssl-dev,pps-tools,python-dev]
    plugin: waf
    source: .
    configflags:
      - --progress
      - --verbose
      - --refclock=all
      - --enable-seccomp
      - --enable-debug
      - --enable-debug-gdb
      - --prefix=/
      - --disable-manpage
      - --notests
      - --nopyc
      - --nopyo
      - --nopycache
      - --python=/usr/bin/python3.5
  files:
    source: etc/
    plugin: dump
    organize:
      conf.d_ntp/default.conf: etc/ntp.conf
      logrotate-config.ntpd: etc/logrotate.d/ntpd
#      '*.service': lib/systemd/system/
      conf.d_ntp: etc/conf.d/ntp
      ntp.d: etc/
